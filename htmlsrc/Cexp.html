<html><head><title> Cexp.nw</title></head><body>
<h1><a name="NWD1">Converting Expressions to C</a></h1>
<code><a href="#NWD1">prettyC</a></code> returns C code for an expression (or statement)
with embedded prettyprinting escapes.
<code>nohex</code> is a purely internal flag.
If it is non-null, constants are in hex; otherwise they're in decimal.
<pre><a name="NWCex7-*-1" href="#NWD1"><dfn>&lt;*&gt;=</dfn></a> <b>[D<a href="#NWCex7-*-2">-&gt;</a>]</b>
procedure <a href="#NWD1">prettyC</a>(e, precedence, associativity, nohex)
  <a name="NWCex7-*-1-u1" href="#NWCex7-locY-1"><i>&lt;local declarations for <code>prettyC</code>&gt;</i></a>
  initial {<a name="NWCex7-*-1-u2" href="#NWCex7-iniZ-1"><i>&lt;initialize <code>Cprec</code> and <code>Cassoc</code>&gt;</i></a>}
  /precedence := 0
  /associativity := &quot;L&quot;
  return case type(e) of {
    <a name="NWCex7-*-1-u3" href="#NWCex7-casL-1"><i>&lt;cases for <code>prettyC</code>&gt;</i></a>
    default    : impossible(&quot;Bad code to <a href="#NWD1">prettyC</a>&quot;)
  }
end
</pre><blockquote>Defines <a href="#NWI-prettyC"><code>prettyC</code></a> (links are to index).<p>
</blockquote><p>
<pre><a name="NWCex7-casL-1" href="#NWCex7-casL-1"><dfn>&lt;cases for <code>prettyC</code>&gt;=</dfn></a> <b>(<a href="#NWD1">&lt;-U</a>)</b> <b>[D<a href="#NWCex7-casL-2">-&gt;</a>]</b>
&quot;list&quot;     : commaseparate(maplist2(<a href="#NWD1">prettyC</a>, e, <a href="#NWCex7-*-8">Cprec</a>[&quot;,&quot;]), &quot;, $o&quot;)
&quot;set&quot;      : commaseparate(maplist2(<a href="#NWD1">prettyC</a>, sort(e), <a href="#NWCex7-*-8">Cprec</a>[&quot;&amp;&amp;&quot;]), &quot; &amp;&amp; $o&quot;)
&quot;eqn&quot;      : { o := <a href="#NWCex7-*-9">Cop</a>(e.op)
               <a href="#NWCex7-*-8">Cbracket</a>(<a href="#NWD1">prettyC</a>(e.left,  <a href="#NWCex7-*-8">Cprec</a>[o]) || &quot; &quot; || o || &quot; $o&quot; ||
                        <a href="#NWD1">prettyC</a>(e.right, <a href="#NWCex7-*-8">Cprec</a>[o]), &quot;==&quot;, precedence)
             }
&quot;table&quot;    : {                      # standard normal form
    <a name="NWCex7-casL-1-u1" href="#NWD2"><i>&lt;make <code>s</code> represent table <code>e</code>, but elide additive and multiplicative units&gt;</i></a>
    &quot;$t${&quot; || s || &quot;$}$b&quot;
  }
&quot;string&quot;   : e
&quot;literal&quot;  : list_to_string(e.s)
&quot;integer&quot;  : if e &gt; max_decimal then &quot;0x&quot; || <a href="#NWCex7-*-B">hexstring</a>(e) else string(e)
</pre><p><a name="NWD2">The old version printed in any old order, but the new version prints</a>
positive terms first, then negative terms, with the constant term last in its group.

<pre><a name="NWCex7-mak1F-1" href="#NWD2"><dfn>&lt;make <code>s</code> represent table <code>e</code>, but elide additive and multiplicative units&gt;=</dfn></a> <b>(<a href="#NWCex7-casL-1">&lt;-U</a>)</b>
{
  s := &quot;&quot;; leadingsign := &quot;&quot;
  <a name="NWCex7-mak1F-1-u1" href="#NWCex7-addR-1"><i>&lt;add positive terms to <code>s</code>&gt;</i></a>
  leadingsign := &quot; - $o&quot;
  <a name="NWCex7-mak1F-1-u2" href="#NWCex7-addR.2-1"><i>&lt;add negative terms to <code>s</code>&gt;</i></a>
  s := if s == &quot;&quot; then &quot;0&quot; else <a href="#NWCex7-*-8">Cbracket</a>(s, &quot;+&quot;, precedence)
}
</pre><pre><a name="NWCex7-addR-1" href="#NWCex7-addR-1"><dfn>&lt;add positive terms to <code>s</code>&gt;=</dfn></a> <b>(<a href="#NWD2">&lt;-U</a>)</b>
every e[k := 1 ~=== key(e)] &gt; 0 do {
    s ||:= leadingsign 
    s ||:= (1 ~= abs(e[k])) || &quot;*&quot;    # print coefficient if not 1
    s ||:= <a href="#NWD1">prettyC</a>(k, <a href="#NWCex7-*-8">Cprec</a>[&quot;*&quot;])
    leadingsign := &quot; + $o&quot;
}
if e[1] &gt; 0 then s ||:= leadingsign || string(e[1])
</pre><pre><a name="NWCex7-addR.2-1" href="#NWCex7-addR.2-1"><dfn>&lt;add negative terms to <code>s</code>&gt;=</dfn></a> <b>(<a href="#NWD2">&lt;-U</a>)</b>
every e[k := 1 ~=== key(e)] &lt; 0 do {
    s ||:= leadingsign 
    s ||:= (1 ~= abs(e[k])) || &quot;*&quot;    # print coefficient if not 1
    s ||:= <a href="#NWD1">prettyC</a>(k, <a href="#NWCex7-*-8">Cprec</a>[&quot;*&quot;])
}
if e[1] &lt; 0 then s ||:= leadingsign || string(-e[1])
</pre><p>
<pre><a name="NWCex7-old1J-1" href="#NWCex7-old1J-1"><dfn>&lt;old make <code>s</code> represent table <code>e</code>, but elide additive and multiplicative units&gt;=</dfn></a>
{
  # print constant term if nonzero
  if e[1] ~= 0 then { s := string(e[1]) ; leadingsign := &quot; + $o&quot; }
  else s := leadingsign := &quot;&quot;
  # print every nonconstant term k
  every k := 1 ~=== key(e) do {
      s ||:= if e[k] &lt; 0 then &quot; - &quot; else leadingsign
      leadingsign := &quot; + $o&quot;
      s ||:= (1 ~= abs(e[k])) || &quot;*&quot;    # print coefficient if not 1
      s ||:= <a href="#NWD1">prettyC</a>(k, <a href="#NWCex7-*-8">Cprec</a>[&quot;*&quot;])
  }
  s := if s == &quot;&quot; then &quot;0&quot; else <a href="#NWCex7-*-8">Cbracket</a>(s, &quot;+&quot;, precedence)
}
</pre><pre><a name="NWCex7-locY-1" href="#NWCex7-locY-1"><dfn>&lt;local declarations for <code>prettyC</code>&gt;=</dfn></a> <b>(<a href="#NWD1">&lt;-U</a>)</b> <b>[D<a href="#NWCex7-locY-2">-&gt;</a>]</b>
local leadingsign
</pre><pre><a name="NWCex7-casL-2" href="#NWCex7-casL-1"><dfn>&lt;cases for <code>prettyC</code>&gt;+=</dfn></a> <b>(<a href="#NWD1">&lt;-U</a>)</b> <b>[<a href="#NWCex7-casL-1">&lt;-</a>D<a href="#NWCex7-casL-3">-&gt;</a>]</b>
&quot;Eorb&quot;     : { s := <a href="#NWD1">prettyC</a>(e.x, <a href="#NWCex7-*-8">Cprec</a>[&quot;|&quot;], &quot;L&quot;)
               t := <a href="#NWD1">prettyC</a>(e.y, <a href="#NWCex7-*-8">Cprec</a>[&quot;|&quot;], &quot;R&quot;)
               <a href="#NWCex7-*-8">Cbracket</a>(s || &quot; | $o&quot; || t, &quot;|&quot;, precedence)
             }
&quot;Eand&quot;     : { s := <a href="#NWD1">prettyC</a>(e.x, <a href="#NWCex7-*-8">Cprec</a>[&quot;&amp;&amp;&quot;], &quot;L&quot;)
               t := <a href="#NWD1">prettyC</a>(e.y, <a href="#NWCex7-*-8">Cprec</a>[&quot;&amp;&amp;&quot;], &quot;R&quot;)
               <a href="#NWCex7-*-8">Cbracket</a>(s || &quot; &amp;&amp; $o&quot; || t, &quot;&amp;&amp;&quot;, precedence)
             }
</pre><pre><a name="NWCex7-casL-3" href="#NWCex7-casL-1"><dfn>&lt;cases for <code>prettyC</code>&gt;+=</dfn></a> <b>(<a href="#NWD1">&lt;-U</a>)</b> <b>[<a href="#NWCex7-casL-2">&lt;-</a>D<a href="#NWCex7-casL-4">-&gt;</a>]</b>
&quot;Eslice&quot;   : { s := <a href="#NWD1">prettyC</a>(super_simplify(Eshift(e.x, -e.lo)), <a href="#NWCex7-*-8">Cprec</a>[&quot;&amp;&quot;], &quot;L&quot;)
               <a href="#NWCex7-*-8">Cbracket</a>(s || &quot; &amp; &quot; || mask(e.n), &quot;&amp;&quot;, precedence)
             }
&quot;Eshift&quot;   : { s := <a href="#NWD1">prettyC</a>(e.x, <a href="#NWCex7-*-8">Cprec</a>[&quot;&lt;&lt;&quot;]) 
               s ||:= if e.n &lt; 0 then (&quot; &gt;&gt; &quot; || -e.n) 
                      else            (&quot; &lt;&lt; &quot; ||  e.n)
               <a href="#NWCex7-*-8">Cbracket</a>(s, &quot;&lt;&lt;&quot;, precedence)
             }
</pre><pre><a name="NWCex7-casL-4" href="#NWCex7-casL-1"><dfn>&lt;cases for <code>prettyC</code>&gt;+=</dfn></a> <b>(<a href="#NWD1">&lt;-U</a>)</b> <b>[<a href="#NWCex7-casL-3">&lt;-</a>D<a href="#NWCex7-casL-5">-&gt;</a>]</b>
&quot;Enarrowu&quot; : <a href="#NWD1">prettyC</a>(e.x, precedence, associativity) # checked, so must be identity
&quot;Enarrows&quot; : <a href="#NWD1">prettyC</a>(super_simplify(Eslice(e.x, 0, e.n)), precedence, associativity)
&quot;Ewiden&quot;   : &quot;sign_extend($t${$o&quot; || <a href="#NWD1">prettyC</a>(e.x) || &quot;, $o&quot; || e.n || &quot;$}$b)&quot;
</pre><pre><a name="NWCex7-casL-5" href="#NWCex7-casL-1"><dfn>&lt;cases for <code>prettyC</code>&gt;+=</dfn></a> <b>(<a href="#NWD1">&lt;-U</a>)</b> <b>[<a href="#NWCex7-casL-4">&lt;-</a>D<a href="#NWD3">-&gt;</a>]</b>
&quot;Ediv&quot;     : { s := <a href="#NWD1">prettyC</a>(e.x, <a href="#NWCex7-*-8">Cprec</a>[&quot;/&quot;]) 
               s := &quot;((int)&quot; || s || &quot;)&quot;   # temporary hack to fix a bug
               s ||:= &quot; / &quot; || e.n
               <a href="#NWCex7-*-8">Cbracket</a>(s, &quot;/&quot;, precedence)
             }
&quot;Emod&quot;     : { s := <a href="#NWD1">prettyC</a>(e.x, <a href="#NWCex7-*-8">Cprec</a>[&quot;%&quot;]) 
               s ||:= &quot; % &quot; || e.n
               <a href="#NWCex7-*-8">Cbracket</a>(s, &quot;%&quot;, precedence)
             }
</pre><p>
<a name="NWD3">Have to be careful emitting no tokens.</a>
<pre><a name="NWCex7-casL-6" href="#NWCex7-casL-1"><dfn>&lt;cases for <code>prettyC</code>&gt;+=</dfn></a> <b>(<a href="#NWD1">&lt;-U</a>)</b> <b>[<a href="#NWCex7-casL-5">&lt;-</a>D<a href="#NWCex7-casL-7">-&gt;</a>]</b>
&quot;Semit&quot;    : 
  if *e.x = 0 then &quot;{/*emit epsilon*/}&quot; else {
    s := if *e.x &gt; 1 then &quot;$t${{ $c&quot; else &quot;&quot;
    <a name="NWCex7-casL-6-u1" href="#NWD5"><i>&lt;if direct style and late pc, add <code>ENCODE_pc</code> declaration to <code>s</code> and set <code>pc_override</code>&gt;</i></a>
    s ||:= commaseparate(maplist(<a href="#NWD1">prettyC</a>, e.x), &quot; $c&quot;)
    <a name="NWCex7-casL-6-u2" href="#NWCex7-resN-1"><i>&lt;restore <code>pc_override</code>&gt;</i></a>
    s || if *e.x &gt; 1 then &quot; $b$c}$}&quot; else &quot;&quot;
  } 
&quot;Stoken&quot; :
  case emitterstyle of {
    &quot;direct&quot; : {<a name="NWCex7-casL-6-u3" href="#NWCex7-dirZ-1"><i>&lt;direct call through <code>emittername</code>&gt;</i></a>}
    &quot;closure&quot;: {<a name="NWCex7-casL-6-u4" href="#NWD4"><i>&lt;closure call to <code>emitter</code>&gt;</i></a>}
  } | impossible(&quot;emitter style&quot;)
</pre><p>
<pre><a name="NWCex7-dirZ-1" href="#NWCex7-dirZ-1"><dfn>&lt;direct call through <code>emittername</code>&gt;=</dfn></a> <b>(<a href="#NWD3">&lt;-U</a>)</b>
s := emittername || &quot;$t(&quot; || <a href="#NWD1">prettyC</a>(e.x, <a href="#NWCex7-*-8">Cprec</a>[&quot;,&quot;]) || &quot;, $o&quot; || e.n || &quot;)&quot;
<a href="#NWCex7-*-8">Cbracket</a>(&quot;$c&quot; || s, &quot;app&quot;, precedence) || &quot;;$b&quot;
</pre><p>
<a name="NWD4">For the closure call, we assume that the closure is stored in local variable </a><code>_c</code>.
<pre><a name="NWCex7-cloR-1" href="#NWD4"><dfn>&lt;closure call to <code>emitter</code>&gt;=</dfn></a> <b>(<a href="#NWD3">&lt;-U</a>)</b>
o := if e.offset &gt; 0 then &quot; + &quot; || e.offset else &quot;&quot;
s := &quot;emitter$t(_c-&gt;loc.dest_block, $o_c-&gt;loc.dest_lc&quot; || o || &quot;, $o&quot; || 
     <a href="#NWD1">prettyC</a>(e.x, <a href="#NWCex7-*-8">Cprec</a>[&quot;,&quot;]) || &quot;, $o&quot; || e.n || &quot;)&quot;
<a href="#NWCex7-*-8">Cbracket</a>(&quot;$c&quot; || s, &quot;app&quot;, precedence) || &quot;;$b&quot;
</pre><p>
<a name="NWD5">This code fixes bug&nbsp;5 by using </a><code>ENCODE_pc</code> instead of <code>cur_pc</code> when
an emitted token other than the first requires the program counter.
It's needed because <code>cur_pc()</code> changes as a side effect of <code>emit</code>, 
but ``the program counter'' always refers to the location of
the <em>first</em> token emitted.
<pre><a name="NWCex7-if*1T-1" href="#NWD5"><dfn>&lt;if direct style and late pc, add <code>ENCODE_pc</code> declaration to <code>s</code> and set <code>pc_override</code>&gt;=</dfn></a> <b>(<a href="#NWD3">&lt;-U</a>)</b>
if *e.x &gt; 1 &amp; emitterstyle == &quot;direct&quot; &amp; expwalk(e.x[2:0], equals_pc) then {
  s ||:= &quot;unsigned ENCODE_pc = cur_pc(); $c&quot;
  save_pc_override := <a href="#NWCex7-*-2">pc_override</a>
  <a href="#NWCex7-*-2">pc_override</a> := &quot;ENCODE_pc&quot;
}
</pre><pre><a name="NWCex7-resN-1" href="#NWCex7-resN-1"><dfn>&lt;restore <code>pc_override</code>&gt;=</dfn></a> <b>(<a href="#NWD3">&lt;-U</a>)</b>
<a href="#NWCex7-*-2">pc_override</a> := save_pc_override
</pre><pre><a name="NWCex7-locY-2" href="#NWCex7-locY-1"><dfn>&lt;local declarations for <code>prettyC</code>&gt;+=</dfn></a> <b>(<a href="#NWD1">&lt;-U</a>)</b> <b>[<a href="#NWCex7-locY-1">&lt;-</a>D<a href="#NWCex7-locY-3">-&gt;</a>]</b>
local save_pc_override
</pre><pre><a name="NWCex7-casL-7" href="#NWCex7-casL-1"><dfn>&lt;cases for <code>prettyC</code>&gt;+=</dfn></a> <b>(<a href="#NWD1">&lt;-U</a>)</b> <b>[<a href="#NWD3">&lt;-</a>D<a href="#NWCex7-casL-8">-&gt;</a>]</b>
&quot;Epc&quot; : \<a href="#NWCex7-*-2">pc_override</a> | &quot;cur_pc()&quot;
&quot;Epc_known&quot; : &quot;cur_pc_known()&quot;
</pre><pre><a name="NWCex7-casL-8" href="#NWCex7-casL-1"><dfn>&lt;cases for <code>prettyC</code>&gt;+=</dfn></a> <b>(<a href="#NWD1">&lt;-U</a>)</b> <b>[<a href="#NWCex7-casL-7">&lt;-</a>D<a href="#NWCex7-casL-9">-&gt;</a>]</b>
&quot;Eclosure_loc&quot;  : &quot;_c-&gt;loc&quot;
&quot;Eclosure_addr&quot; : &quot;_c-&gt;v.a&quot; || e.n
&quot;Eclosure_val&quot;  : &quot;_c-&gt;v.u&quot; || e.n
</pre><pre><a name="NWCex7-*-2" href="#NWD1"><dfn>&lt;*&gt;+=</dfn></a> <b>[<a href="#NWD1">&lt;-</a>D<a href="#NWCex7-*-3">-&gt;</a>]</b>
global <a href="#NWCex7-*-2">pc_override</a>
</pre><blockquote>Defines <a href="#NWI-pc_override"><code>pc_override</code></a> (links are to index).<p>
</blockquote><p>
<pre><a name="NWCex7-casL-9" href="#NWCex7-casL-1"><dfn>&lt;cases for <code>prettyC</code>&gt;+=</dfn></a> <b>(<a href="#NWD1">&lt;-U</a>)</b> <b>[<a href="#NWCex7-casL-8">&lt;-</a>D<a href="#NWCex7-casL-A">-&gt;</a>]</b>
&quot;Efitsu&quot;   : { s := &quot;(unsigned)(&quot; || <a href="#NWD1">prettyC</a>(e.x) || &quot;) &lt; &quot; || tworaised(e.n)
               <a href="#NWCex7-*-8">Cbracket</a>(s, &quot;&lt;&quot;, precedence)
             }
&quot;Efitss&quot;   : { s := &quot;(unsigned)(&quot; || <a href="#NWD1">prettyC</a>(addconst(e.x, 2^(e.n-1))) ||
                                         &quot;) &lt; &quot; || tworaised(e.n)
               <a href="#NWCex7-*-8">Cbracket</a>(s, &quot;&lt;&quot;, precedence)
             }
</pre><pre><a name="NWCex7-casL-A" href="#NWCex7-casL-1"><dfn>&lt;cases for <code>prettyC</code>&gt;+=</dfn></a> <b>(<a href="#NWD1">&lt;-U</a>)</b> <b>[<a href="#NWCex7-casL-9">&lt;-</a>D<a href="#NWCex7-casL-B">-&gt;</a>]</b>
&quot;Eforce&quot; | &quot;Eforceable&quot;  : {
                    (if type(e.x) == &quot;Eclosure_loc&quot; then &quot;pc_&quot; else &quot;&quot;) || 
                    &quot;location&quot; ||
                    (if type(e) == &quot;Eforceable&quot; then &quot;_known&quot; else &quot;&quot;) ||
                    &quot;$t${(&quot; || <a href="#NWD1">prettyC</a>(e.x) || &quot;)$}$b&quot;
             }
</pre><pre><a name="NWCex7-casL-B" href="#NWCex7-casL-1"><dfn>&lt;cases for <code>prettyC</code>&gt;+=</dfn></a> <b>(<a href="#NWD1">&lt;-U</a>)</b> <b>[<a href="#NWCex7-casL-A">&lt;-</a>D<a href="#NWCex7-casL-C">-&gt;</a>]</b>
&quot;Enot&quot;      : { s := &quot;!&quot; || <a href="#NWD1">prettyC</a>(e.x, <a href="#NWCex7-*-8">Cprec</a>[&quot;!&quot;])
                <a href="#NWCex7-*-8">Cbracket</a>(s, &quot;!&quot;, precedence)
              }
</pre><pre><a name="NWCex7-casL-C" href="#NWCex7-casL-1"><dfn>&lt;cases for <code>prettyC</code>&gt;+=</dfn></a> <b>(<a href="#NWD1">&lt;-U</a>)</b> <b>[<a href="#NWCex7-casL-B">&lt;-</a>D<a href="#NWCex7-casL-D">-&gt;</a>]</b>
&quot;Enosimp&quot;   : <a href="#NWD1">prettyC</a>(e.x, precedence, associativity)
</pre><pre><a name="NWCex7-casL-D" href="#NWCex7-casL-1"><dfn>&lt;cases for <code>prettyC</code>&gt;+=</dfn></a> <b>(<a href="#NWD1">&lt;-U</a>)</b> <b>[<a href="#NWCex7-casL-C">&lt;-</a>D<a href="#NWCex7-casL-E">-&gt;</a>]</b>
&quot;Sstmts&quot;    : &quot;$t${{ $c&quot; || commaseparate(maplist2(<a href="#NWD1">prettyC</a>, e.x), &quot; $c&quot;) || &quot; $b$c}$}&quot;
</pre><pre><a name="NWCex7-casL-E" href="#NWCex7-casL-1"><dfn>&lt;cases for <code>prettyC</code>&gt;+=</dfn></a> <b>(<a href="#NWD1">&lt;-U</a>)</b> <b>[<a href="#NWCex7-casL-D">&lt;-</a>D<a href="#NWCex7-casL-F">-&gt;</a>]</b>
&quot;Gcall&quot; : { l := []; every put(l, <a href="#NWD1">prettyC</a>(!e.args))
            <a href="#NWCex7-*-A">Cnoreserve</a>(e.name) || &quot;(&quot; || commaseparate(l) || &quot;)&quot;
         }
</pre><pre><a name="NWCex7-casL-F" href="#NWCex7-casL-1"><dfn>&lt;cases for <code>prettyC</code>&gt;+=</dfn></a> <b>(<a href="#NWD1">&lt;-U</a>)</b> <b>[<a href="#NWCex7-casL-E">&lt;-</a>D<a href="#NWD6">-&gt;</a>]</b>
&quot;Einstance_input&quot; : { 
               s := <a href="#NWD1">prettyC</a>(e.x, <a href="#NWCex7-*-8">Cprec</a>[&quot;.&quot;]) || &quot;.u.&quot; || e.cons.name || &quot;.&quot; || e.name
               <a href="#NWCex7-*-8">Cbracket</a>(s, &quot;.&quot;, precedence)
             }
&quot;Einstance_tagged&quot; : { 
               s := <a href="#NWD1">prettyC</a>(e.x, <a href="#NWCex7-*-8">Cprec</a>[&quot;=&quot;]) || &quot;.tag == &quot; || e.cons.name || &quot;_TAG&quot;
               <a href="#NWCex7-*-8">Cbracket</a>(s, &quot;==&quot;, precedence)
             }
</pre><p>
<a name="NWD6">I assume the if statement has been simplified, so there are no arms beyond</a>
any <code>else</code> arm
<pre><a name="NWCex7-casL-G" href="#NWCex7-casL-1"><dfn>&lt;cases for <code>prettyC</code>&gt;+=</dfn></a> <b>(<a href="#NWD1">&lt;-U</a>)</b> <b>[<a href="#NWCex7-casL-F">&lt;-</a>D<a href="#NWCex7-casL-H">-&gt;</a>]</b>
&quot;Sif&quot;      : { preif := &quot;&quot;
               s := &quot;&quot;
               every a := !e.arms do {
                 s ||:= preif || <a href="#NWCex7-*-3">Ctest</a>(a.guard) || <a href="#NWCex7-*-4">Carm</a>(a.x)
                 preif := &quot;$celse &quot;
               }
               &quot;${&quot; || s || &quot;$}&quot;
             }
</pre><pre><a name="NWCex7-casL-H" href="#NWCex7-casL-1"><dfn>&lt;cases for <code>prettyC</code>&gt;+=</dfn></a> <b>(<a href="#NWD1">&lt;-U</a>)</b> <b>[<a href="#NWD6">&lt;-</a>D<a href="#NWCex7-casL-I">-&gt;</a>]</b>
&quot;Efail&quot; : error(&quot;Generate-time operation failed: &quot;, e.msg)
</pre><pre><a name="NWCex7-*-3" href="#NWD1"><dfn>&lt;*&gt;+=</dfn></a> <b>[<a href="#NWCex7-*-2">&lt;-</a>D<a href="#NWCex7-*-4">-&gt;</a>]</b>
procedure <a href="#NWCex7-*-3">Ctest</a>(guard)
  return if guard_always_satisfied(guard) then &quot;&quot;
         else &quot;if $t${(&quot; || <a href="#NWD1">prettyC</a>(guard) || &quot;)$}$b &quot;
end
</pre><blockquote>Defines <a href="#NWI-Ctest"><code>Ctest</code></a> (links are to index).<p>
</blockquote><pre><a name="NWCex7-*-4" href="#NWD1"><dfn>&lt;*&gt;+=</dfn></a> <b>[<a href="#NWCex7-*-3">&lt;-</a>D<a href="#NWD7">-&gt;</a>]</b>
procedure <a href="#NWCex7-*-4">Carm</a>(e)
  return if type(e) == (&quot;Gblock&quot;|&quot;Sstmts&quot;) then <a href="#NWD1">prettyC</a>(e) || &quot; &quot;
         else &quot;$t$c${&quot; || <a href="#NWD1">prettyC</a>(e) || &quot;$}$b &quot;
end
</pre><blockquote>Defines <a href="#NWI-Carm"><code>Carm</code></a> (links are to index).<p>
</blockquote><pre><a name="NWCex7-casL-I" href="#NWCex7-casL-1"><dfn>&lt;cases for <code>prettyC</code>&gt;+=</dfn></a> <b>(<a href="#NWD1">&lt;-U</a>)</b> <b>[<a href="#NWCex7-casL-H">&lt;-</a>D<a href="#NWCex7-casL-J">-&gt;</a>]</b>
&quot;Stagcase&quot; : { s := &quot;switch (&quot; || <a href="#NWD1">prettyC</a>(e.x, <a href="#NWCex7-*-8">Cprec</a>[&quot;.&quot;]) || &quot;.tag) {$t${&quot;
              every c := kept_constructors(e.type) do
                s ||:= &quot;$ccase &quot; || c.name || &quot;_TAG: $t$c${&quot; ||
                          <a href="#NWD1">prettyC</a>(e.arms[c]) || &quot; $cbreak;$}$b&quot;
              s || &quot;$cdefault: assert(0);$}$b$c} /* &quot; || 
                             <a href="#NWD7">Cuncomment</a>(<a href="#NWD1">prettyC</a>(e.x)) || &quot; */&quot;
            }
</pre><p><a name="NWD7">C comments don't nest, but some implemenations might.</a>
<pre><a name="NWCex7-*-5" href="#NWD1"><dfn>&lt;*&gt;+=</dfn></a> <b>[<a href="#NWCex7-*-4">&lt;-</a>D<a href="#NWCex7-*-6">-&gt;</a>]</b>
procedure <a href="#NWD7">Cuncomment</a>(s)
  r := &quot;&quot;
  s ? {
    while r ||:= tab(upto('/*')) do
      if =&quot;/*&quot; then r ||:= &quot;--&quot;
      else if =&quot;*/&quot; then r ||:= &quot;--&quot;
      else r ||:= move(1)
    return r || tab(0)
  }
end
</pre><blockquote>Defines <a href="#NWI-Cuncomment"><code>Cuncomment</code></a> (links are to index).<p>
</blockquote><pre><a name="NWCex7-casL-J" href="#NWCex7-casL-1"><dfn>&lt;cases for <code>prettyC</code>&gt;+=</dfn></a> <b>(<a href="#NWD1">&lt;-U</a>)</b> <b>[<a href="#NWCex7-casL-I">&lt;-</a>D<a href="#NWCex7-casL-K">-&gt;</a>]</b>
&quot;Sfail&quot;    : { s := &quot;fail($t${&quot; || image(escape_dollars(e.fmt))
               every a := e.a1 | e.a2 | e.a3 do 
                 s ||:= &quot;, $o&quot; || <a href="#NWD1">prettyC</a>(\a, <a href="#NWCex7-*-8">Cprec</a>[&quot;,&quot;])
               s ||:= &quot;$}$b);&quot;
               <a href="#NWCex7-*-8">Cbracket</a>(s, &quot;app&quot;, precedence)
             }
&quot;Sepsilon&quot; : &quot;{/* skip */}&quot;
</pre><pre><a name="NWCex7-casL-K" href="#NWCex7-casL-1"><dfn>&lt;cases for <code>prettyC</code>&gt;+=</dfn></a> <b>(<a href="#NWD1">&lt;-U</a>)</b> <b>[<a href="#NWCex7-casL-J">&lt;-</a>D<a href="#NWCex7-casL-L">-&gt;</a>]</b>
&quot;Sclosure&quot; : <a href="#NWD1">prettyC</a>(\e.creation) | impossible(&quot;creating closure&quot;)
</pre><pre><a name="NWCex7-casL-L" href="#NWCex7-casL-1"><dfn>&lt;cases for <code>prettyC</code>&gt;+=</dfn></a> <b>(<a href="#NWD1">&lt;-U</a>)</b> <b>[<a href="#NWCex7-casL-K">&lt;-</a>D<a href="#NWCex7-casL-M">-&gt;</a>]</b>
&quot;Glines&quot;    : { s := &quot;&quot;; every s ||:= <a href="#NWD1">prettyC</a>(!e.x) || &quot;\n&quot;; s }
&quot;Gresynch&quot;  : &quot;$n#line &quot; || e.line  || &quot; &quot; || image(\e.file | &quot;generated-code&quot;)
</pre><pre><a name="NWCex7-casL-M" href="#NWCex7-casL-1"><dfn>&lt;cases for <code>prettyC</code>&gt;+=</dfn></a> <b>(<a href="#NWD1">&lt;-U</a>)</b> <b>[<a href="#NWCex7-casL-L">&lt;-</a>D<a href="#NWCex7-casL-N">-&gt;</a>]</b>
&quot;Gblock&quot;    : { s := &quot;{ ${$t$c&quot;
                every s ||:= <a href="#NWD1">prettyC</a>(!e.decls) || &quot;;$n&quot;
                s ||:= commaseparate(maplist(<a href="#NWD1">prettyC</a>, e.stmts), &quot;$c&quot;)
                s || &quot;$b $c}$}&quot;
              }
&quot;Gdecl&quot;     : { s := &quot;${&quot; || <a href="#NWD1">prettyC</a>(\e.type | <a href="#NWCex7-*-6">infer_C_type</a>(e.init))
                s ||:= &quot; &quot; || e.name 
                s ||:= &quot; = $t$c&quot; || <a href="#NWD1">prettyC</a>(\e.init) || &quot;$b&quot;
                s || &quot;$}&quot;
              }
</pre><pre><a name="NWCex7-*-6" href="#NWD1"><dfn>&lt;*&gt;+=</dfn></a> <b>[<a href="#NWD7">&lt;-</a>D<a href="#NWCex7-*-7">-&gt;</a>]</b>
procedure <a href="#NWCex7-*-6">infer_C_type</a>(value)
  if /value then impossible(&quot;variable with no type and no value&quot;)
  return case type(value) of {
    &quot;Ewiden&quot; : Tsigned(value.n)
    default  : Tunsigned(wordsize)
  }
end
</pre><blockquote>Defines <a href="#NWI-infer_C_type"><code>infer_C_type</code></a> (links are to index).<p>
</blockquote><pre><a name="NWCex7-casL-N" href="#NWCex7-casL-1"><dfn>&lt;cases for <code>prettyC</code>&gt;+=</dfn></a> <b>(<a href="#NWD1">&lt;-U</a>)</b> <b>[<a href="#NWCex7-casL-M">&lt;-</a>D<a href="#NWCex7-casL-O">-&gt;</a>]</b>
&quot;Gdeclnamearray&quot; : {
  /na_count := 0
  /e.na.codename := &quot;MATCH_name_&quot; || e.na.field.field.name || &quot;_&quot; || (na_count +:= 1)
  /e.na.storageclass := &quot;static&quot;
  s := e.na.storageclass || &quot; char *&quot; || e.na.codename || &quot;[] = {&quot;
  s ||:= &quot;${$t&quot;
  every i := 0 to e.na.hi - 1 do
    s ||:= &quot; $c&quot; || escape_dollars(image(\e.na.tbl[i]|0)) || &quot;,&quot;
  s || &quot;$b $c$}}&quot;
}
</pre><pre><a name="NWCex7-locY-3" href="#NWCex7-locY-1"><dfn>&lt;local declarations for <code>prettyC</code>&gt;+=</dfn></a> <b>(<a href="#NWD1">&lt;-U</a>)</b> <b>[<a href="#NWCex7-locY-2">&lt;-</a>D]</b>
static na_count
</pre><pre><a name="NWCex7-casL-O" href="#NWCex7-casL-1"><dfn>&lt;cases for <code>prettyC</code>&gt;+=</dfn></a> <b>(<a href="#NWD1">&lt;-U</a>)</b> <b>[<a href="#NWCex7-casL-N">&lt;-</a>D<a href="#NWCex7-casL-P">-&gt;</a>]</b>
&quot;Gsetname&quot;  : &quot;char *&quot; || e.lhs || &quot; = ${$t$o&quot; || case type(e.name) of {
                   &quot;string&quot;    : image(e.name)
                   &quot;namearray&quot; : e.name.codename || &quot;[&quot; || <a href="#NWD1">prettyC</a>(e.name.field) || &quot;]&quot;
                   default     : impossible(&quot;type of node name field&quot;)
              } || &quot;$b$}&quot;
</pre><pre><a name="NWCex7-casL-P" href="#NWCex7-casL-1"><dfn>&lt;cases for <code>prettyC</code>&gt;+=</dfn></a> <b>(<a href="#NWD1">&lt;-U</a>)</b> <b>[<a href="#NWCex7-casL-O">&lt;-</a>D<a href="#NWCex7-casL-Q">-&gt;</a>]</b>
&quot;Gcase&quot;     : { s := &quot;switch (&quot; || <a href="#NWD1">prettyC</a>(e.x) || &quot;) {$t${ &quot;
                every s ||:= <a href="#NWD1">prettyC</a>(!e.arms)
                s || &quot;$cdefault: assert(0);$}$b$c} /* &quot; || 
                                <a href="#NWD7">Cuncomment</a>(<a href="#NWD1">prettyC</a>(e.x)) || &quot; */&quot;
               }
&quot;Gcasearm&quot;  : { s := &quot;$n&quot;
                every i := 1 to *e.tags by 2 do {
                  if e.tags[i] + 1 = e.tags[i+1] then 
                    s ||:= &quot;$ocase &quot; || e.tags[i] || &quot;: &quot; 
                  else 
                    every s ||:= &quot;$ocase &quot; || (e.tags[i] to (e.tags[i+1]-1)) || &quot;: &quot;
                } 
                s ||:= &quot;$t$c${&quot; || <a href="#NWD1">prettyC</a>(e.x) || &quot;$cbreak;$}$b&quot;
              }
</pre><pre><a name="NWCex7-casL-Q" href="#NWCex7-casL-1"><dfn>&lt;cases for <code>prettyC</code>&gt;+=</dfn></a> <b>(<a href="#NWD1">&lt;-U</a>)</b> <b>[<a href="#NWCex7-casL-P">&lt;-</a>D<a href="#NWCex7-casL-R">-&gt;</a>]</b>
&quot;Ginrange&quot;  : { x := <a href="#NWD1">prettyC</a>(e.x, <a href="#NWCex7-*-8">Cprec</a>[&quot;&lt;&quot;])
                if e.lo + 1 = e.hi then {
                  <a href="#NWCex7-*-8">Cbracket</a>(x || &quot; == &quot; || e.lo, &quot;==&quot;, <a href="#NWCex7-*-8">Cprec</a>[&quot;&amp;&amp;&quot;])
                } else {
                  c1 := <a href="#NWCex7-*-8">Cbracket</a>(e.lo || &quot; &lt;= &quot; || x, &quot;&lt;=&quot;, <a href="#NWCex7-*-8">Cprec</a>[&quot;&amp;&amp;&quot;])
                  c2 := <a href="#NWCex7-*-8">Cbracket</a>(x || &quot; &lt; &quot; || e.hi, &quot;&lt;&quot;, <a href="#NWCex7-*-8">Cprec</a>[&quot;&amp;&amp;&quot;])
                  <a href="#NWCex7-*-8">Cbracket</a>(c1 || &quot; &amp;&amp; &quot; || c2, &quot;&amp;&amp;&quot;, precedence)
                }
              }
&quot;Gsetname&quot;  : &quot;${&quot; || e.lhs || &quot; = $t$o&quot; || case type(e.name) of {
                   &quot;string&quot;    : image(e.name)
                   &quot;namearray&quot; : e.name.codename || &quot;[&quot; || e.name.field.name || &quot;]&quot;
                   default     : impossible(&quot;type of node name field&quot;)
              } || &quot;;$b$}&quot;
&quot;Gasgn&quot;  : &quot;${&quot; || <a href="#NWD1">prettyC</a>(e.lhs) || &quot; = $t$o&quot; || <a href="#NWD1">prettyC</a>(e.x, <a href="#NWCex7-*-8">Cprec</a>[&quot;=&quot;]) || &quot;;$b$}&quot;
</pre><pre><a name="NWCex7-casL-R" href="#NWCex7-casL-1"><dfn>&lt;cases for <code>prettyC</code>&gt;+=</dfn></a> <b>(<a href="#NWD1">&lt;-U</a>)</b> <b>[<a href="#NWCex7-casL-Q">&lt;-</a>D<a href="#NWCex7-casL-S">-&gt;</a>]</b>
&quot;Gnomatch&quot;  : &quot;assert(0); /* no match */$n&quot;
&quot;Tunsigned&quot; : <a href="#NWCex7-*-7">unsigned_type</a>(e.width)
&quot;Tsigned&quot;   : <a href="#NWCex7-*-7">signed_type</a>(e.width)
&quot;Gcomment&quot;  : &quot;/* &quot; || <a href="#NWD7">Cuncomment</a>(e.s) || &quot; */&quot;
&quot;Gcommented&quot; : 
  <a href="#NWD1">prettyC</a>(e.e, precedence, associativity, nohex) || 
     &quot; /* &quot; || <a href="#NWD7">Cuncomment</a>(e.comment) || &quot; */&quot;
</pre><pre><a name="NWCex7-*-7" href="#NWD1"><dfn>&lt;*&gt;+=</dfn></a> <b>[<a href="#NWCex7-*-6">&lt;-</a>D<a href="#NWCex7-*-8">-&gt;</a>]</b>
procedure <a href="#NWCex7-*-7">unsigned_type</a>(width)
  return &quot;unsigned&quot; || <a href="#NWCex7-*-7">unsigned_width_comment</a>(width)
end
procedure <a href="#NWCex7-*-7">signed_type</a>(width)
  return &quot;int&quot; || <a href="#NWCex7-*-7">signed_width_comment</a>(width)
end
procedure <a href="#NWCex7-*-7">unsigned_width_comment</a>(width)
  return if \width &lt; wordsize then &quot; /* [0..&quot; || (2^width-1) || &quot;] */&quot; else &quot;&quot;
end
procedure <a href="#NWCex7-*-7">signed_width_comment</a>(width)
  return if \width &lt; wordsize then 
    &quot; /* [&quot; || -(2^(width-1)) || &quot;..&quot; || (2^(width-1)-1) || &quot;] */&quot; 
  else 
    &quot;&quot;
end
</pre><blockquote>Defines <a href="#NWI-signed_type"><code>signed_type</code></a>, <a href="#NWI-signed_width_comment"><code>signed_width_comment</code></a>, <a href="#NWI-unsigned_type"><code>unsigned_type</code></a>, <a href="#NWI-unsigned_width_comment"><code>unsigned_width_comment</code></a> (links are to index).<p>
</blockquote><pre><a name="NWCex7-casL-S" href="#NWCex7-casL-1"><dfn>&lt;cases for <code>prettyC</code>&gt;+=</dfn></a> <b>(<a href="#NWD1">&lt;-U</a>)</b> <b>[<a href="#NWCex7-casL-R">&lt;-</a>D]</b>
&quot;absolute_field&quot; : 
   <a href="#NWD1">prettyC</a>(super_simplify(afieldexp(e)), precedence, associativity, nohex)
</pre><pre><a name="NWCex7-*-8" href="#NWD1"><dfn>&lt;*&gt;+=</dfn></a> <b>[<a href="#NWCex7-*-7">&lt;-</a>D<a href="#NWCex7-*-9">-&gt;</a>]</b>
global <a href="#NWCex7-*-8">Cprec</a>, <a href="#NWCex7-*-8">Cassoc</a>
procedure <a href="#NWCex7-*-8">Cbracket</a>(s, op, p, a)
  /a := &quot;L&quot;
  return &quot;${&quot; || (if <a href="#NWCex7-*-8">Cprec</a>[op] &gt; p | (<a href="#NWCex7-*-8">Cprec</a>[op] = p &amp; <a href="#NWCex7-*-8">Cassoc</a>[p] == a) then s
                   else &quot;(&quot; || s || &quot;)&quot;) || &quot;$}&quot;
end
</pre><blockquote>Defines <a href="#NWI-Cassoc"><code>Cassoc</code></a>, <a href="#NWI-Cbracket"><code>Cbracket</code></a>, <a href="#NWI-Cprec"><code>Cprec</code></a> (links are to index).<p>
</blockquote><pre><a name="NWCex7-iniZ-1" href="#NWCex7-iniZ-1"><dfn>&lt;initialize <code>Cprec</code> and <code>Cassoc</code>&gt;=</dfn></a> <b>(<a href="#NWD1">&lt;-U</a>)</b>
ops := [&quot;N&quot;, [&quot;low&quot;],
        &quot;L&quot;, [&quot;;&quot;],
        &quot;L&quot;, [&quot;,&quot;],
        &quot;R&quot;, [&quot;=&quot;, &quot;+=&quot;, &quot;-=&quot;, &quot;*=&quot;, &quot;/=&quot;, &quot;%=&quot;, &quot;&amp;=&quot;, &quot;^=&quot;, &quot;|=&quot;, &quot;&gt;&gt;=&quot;, &quot;&lt;&lt;=&quot;],
        &quot;R&quot;, [&quot;:?&quot;],
        &quot;L&quot;, [&quot;||&quot;], 
        &quot;L&quot;, [&quot;&amp;&amp;&quot;], 
        &quot;L&quot;, [&quot;|&quot;], 
        &quot;L&quot;, [&quot;^&quot;],
        &quot;L&quot;, [&quot;&amp;&quot;], 
        &quot;L&quot;, [&quot;==&quot;, &quot;!=&quot;],
        &quot;L&quot;, [&quot;&lt;=&quot;, &quot;&lt;&quot;, &quot;&gt;=&quot;, &quot;&gt;&quot;],
        &quot;L&quot;, [&quot;&gt;&gt;&quot;, &quot;&lt;&lt;&quot;],
        &quot;L&quot;, [&quot;+&quot;, &quot;-&quot;],
        &quot;L&quot;, [&quot;%&quot;, &quot;/&quot;, &quot;*&quot;],
        &quot;R&quot;, [&quot;!&quot;, &quot;~&quot;, &quot;++&quot;, &quot;--&quot;, &quot;cast&quot;, &quot;sizeof&quot;],
        &quot;L&quot;, [&quot;.&quot;, &quot;-&gt;&quot;, &quot;app&quot;],
        &quot;N&quot;, [&quot;high&quot;]
       ]
<a href="#NWCex7-*-8">Cprec</a> := table([])  # missed lookups break arithmetic comparisons
<a href="#NWCex7-*-8">Cassoc</a> := table()
every i := 1 to *ops by 2 do {
  every <a href="#NWCex7-*-8">Cprec</a>[!ops[i+1]] := i
  <a href="#NWCex7-*-8">Cassoc</a>[i] := ops[i]
}
</pre><p>
<pre><a name="NWCex7-*-9" href="#NWD1"><dfn>&lt;*&gt;+=</dfn></a> <b>[<a href="#NWCex7-*-8">&lt;-</a>D<a href="#NWCex7-*-A">-&gt;</a>]</b>
procedure <a href="#NWCex7-*-9">Cop</a>(op)
  return if op == &quot;=&quot; then &quot;==&quot; else op
end
</pre><blockquote>Defines <a href="#NWI-Cop"><code>Cop</code></a> (links are to index).<p>
</blockquote><pre><a name="NWCex7-*-A" href="#NWD1"><dfn>&lt;*&gt;+=</dfn></a> <b>[<a href="#NWCex7-*-9">&lt;-</a>D<a href="#NWCex7-*-B">-&gt;</a>]</b>
procedure <a href="#NWCex7-*-A">Cnoreserve</a>(word) 
  static reserved
  initial reserved := set([
        &quot;asm&quot;, &quot;auto&quot;, &quot;break&quot;, &quot;case&quot;, &quot;char&quot;, &quot;const&quot;, &quot;continue&quot;,
        &quot;default&quot;, &quot;double&quot;, &quot;do&quot;, &quot;else&quot;, &quot;enum&quot;, &quot;extern&quot;, &quot;float&quot;, &quot;for&quot;,
        &quot;goto&quot;, &quot;if&quot;, &quot;int&quot;, &quot;long&quot;, &quot;register&quot;, &quot;return&quot;, &quot;short&quot;,
        &quot;signed&quot;, &quot;sizeof&quot;, &quot;static&quot;, &quot;struct&quot;, &quot;switch&quot;, &quot;typedef&quot;, &quot;union&quot;,
        &quot;unsigned&quot;, &quot;void&quot;, &quot;volatile&quot;, &quot;while&quot;])
  return if member(reserved, word) then <a href="#NWCex7-*-A">Cnoreserve</a>(word||&quot;_&quot;) else word
end
</pre><blockquote>Defines <a href="#NWI-Cnoreserve"><code>Cnoreserve</code></a> (links are to index).<p>
</blockquote><pre><a name="NWCex7-*-B" href="#NWD1"><dfn>&lt;*&gt;+=</dfn></a> <b>[<a href="#NWCex7-*-A">&lt;-</a>D<a href="#NWD8">-&gt;</a>]</b>
procedure <a href="#NWCex7-*-B">hexstring</a>(i,n)
   local s
   if i = 0 then s := &quot;0&quot;
   else {
      s := &quot;&quot;
      while i ~= 0 do {
         s := &quot;0123456789abcdef&quot;[iand(i,15) + 1] || s
         i := ishift(i,-4)
         }
      }
   if \n &gt; *s then s := right(s,n,&quot;0&quot;)
   return s
end
</pre><blockquote>Defines <a href="#NWI-hexstring"><code>hexstring</code></a> (links are to index).<p>
</blockquote><p>
<h2><a name="NWD8">Support for decoding code in C</a></h2>
<pre><a name="NWCex7-*-C" href="#NWD1"><dfn>&lt;*&gt;+=</dfn></a> <b>[<a href="#NWCex7-*-B">&lt;-</a>D<a href="#NWD9">-&gt;</a>]</b>
procedure <a href="#NWD8">Generate_C</a>()
  pretty := <a href="#NWD1">prettyC</a>
  hex_prefix := &quot;0x&quot;
  gen_outer_decls := []
  gen_file_header := [&quot;#include &lt;assert.h&gt;\n&quot;,
     &quot;#define sign_extend(N,SIZE) &quot;, # no newline after #define
         &quot;(((int)((N) &lt;&lt; (sizeof(unsigned)*8-(SIZE)))) &gt;&gt; (sizeof(unsigned)*8-(SIZE)))&quot;
     ]
  fetchtab[&quot;type&quot;] := &quot;unsigned char *&quot;;
  fetchtab[&quot;add&quot;] := &quot;((%a) + %o)&quot;
  fetchtab[&quot;integer&quot;] := &quot;(unsigned)(%a)&quot;
#  fetchtab[8]  := &quot;(unsigned)*(unsigned char *) (%a+%o/8)&quot;
#  fetchtab[16] := &quot;(unsigned)*(unsigned short *)(%a+%o/16)&quot;
#  fetchtab[32] := &quot;(unsigned)*(unsigned *)      (%a+%o/32)&quot;
end
</pre><blockquote>Defines <a href="#NWI-Generate_C"><code>Generate_C</code></a> (links are to index).<p>
</blockquote><p>
<a name="NWD9">Used to declare functions according to the proper style of</a>
indirection.
<pre><a name="NWCex7-*-D" href="#NWD1"><dfn>&lt;*&gt;+=</dfn></a> <b>[<a href="#NWD8">&lt;-</a>D]</b>
procedure <a href="#NWD9">c_function_declaration</a>(pp, returntype, name, args, indirect)
  emit_template(pp, if \indirectname then &quot;indirect-proto.t&quot; else &quot;direct-proto.t&quot;,
                    &quot;return&quot;, returntype, &quot;name&quot;, name, &quot;args&quot;, args)
  return
end
</pre><blockquote>Defines <a href="#NWI-c_function_declaration"><code>c_function_declaration</code></a> (links are to index).<p>
</blockquote><pre><a name="NWCex7-dirE-1" href="#NWCex7-dirE-1"><dfn>&lt;direct-proto.t&gt;=</dfn></a>
extern %return %name(%args);
</pre><pre><a name="NWCex7-indG-1" href="#NWCex7-indG-1"><dfn>&lt;indirect-proto.t&gt;=</dfn></a>
%return (*%name)(%args);
</pre>

<ul>
<li><a href="#NWD1"><i>&lt;*&gt;</i></a>: <a href="#NWD1">D1</a>, <a href="#NWCex7-*-2">D2</a>, <a href="#NWCex7-*-3">D3</a>, <a href="#NWCex7-*-4">D4</a>, <a href="#NWD7">D5</a>, <a href="#NWCex7-*-6">D6</a>, <a href="#NWCex7-*-7">D7</a>, <a href="#NWCex7-*-8">D8</a>, <a href="#NWCex7-*-9">D9</a>, <a href="#NWCex7-*-A">D10</a>, <a href="#NWCex7-*-B">D11</a>, <a href="#NWD8">D12</a>, <a href="#NWD9">D13</a>
<li><a href="#NWCex7-addR.2-1"><i>&lt;add negative terms to <code>s</code>&gt;</i></a>: <a href="#NWD2">U1</a>, <a href="#NWCex7-addR.2-1">D2</a>
<li><a href="#NWCex7-addR-1"><i>&lt;add positive terms to <code>s</code>&gt;</i></a>: <a href="#NWD2">U1</a>, <a href="#NWCex7-addR-1">D2</a>
<li><a href="#NWCex7-casL-1"><i>&lt;cases for <code>prettyC</code>&gt;</i></a>: <a href="#NWD1">U1</a>, <a href="#NWCex7-casL-1">D2</a>, <a href="#NWCex7-casL-2">D3</a>, <a href="#NWCex7-casL-3">D4</a>, <a href="#NWCex7-casL-4">D5</a>, <a href="#NWCex7-casL-5">D6</a>, <a href="#NWD3">D7</a>, <a href="#NWCex7-casL-7">D8</a>, <a href="#NWCex7-casL-8">D9</a>, <a href="#NWCex7-casL-9">D10</a>, <a href="#NWCex7-casL-A">D11</a>, <a href="#NWCex7-casL-B">D12</a>, <a href="#NWCex7-casL-C">D13</a>, <a href="#NWCex7-casL-D">D14</a>, <a href="#NWCex7-casL-E">D15</a>, <a href="#NWCex7-casL-F">D16</a>, <a href="#NWD6">D17</a>, <a href="#NWCex7-casL-H">D18</a>, <a href="#NWCex7-casL-I">D19</a>, <a href="#NWCex7-casL-J">D20</a>, <a href="#NWCex7-casL-K">D21</a>, <a href="#NWCex7-casL-L">D22</a>, <a href="#NWCex7-casL-M">D23</a>, <a href="#NWCex7-casL-N">D24</a>, <a href="#NWCex7-casL-O">D25</a>, <a href="#NWCex7-casL-P">D26</a>, <a href="#NWCex7-casL-Q">D27</a>, <a href="#NWCex7-casL-R">D28</a>, <a href="#NWCex7-casL-S">D29</a>
<li><a href="#NWD4"><i>&lt;closure call to <code>emitter</code>&gt;</i></a>: <a href="#NWD3">U1</a>, <a href="#NWD4">D2</a>
<li><a href="#NWCex7-dirZ-1"><i>&lt;direct call through <code>emittername</code>&gt;</i></a>: <a href="#NWD3">U1</a>, <a href="#NWCex7-dirZ-1">D2</a>
<li><a href="#NWCex7-dirE-1"><i>&lt;direct-proto.t&gt;</i></a>: <a href="#NWCex7-dirE-1">D1</a>
<li><a href="#NWD5"><i>&lt;if direct style and late pc, add <code>ENCODE_pc</code> declaration to <code>s</code> and set <code>pc_override</code>&gt;</i></a>: <a href="#NWD3">U1</a>, <a href="#NWD5">D2</a>
<li><a href="#NWCex7-indG-1"><i>&lt;indirect-proto.t&gt;</i></a>: <a href="#NWCex7-indG-1">D1</a>
<li><a href="#NWCex7-iniZ-1"><i>&lt;initialize <code>Cprec</code> and <code>Cassoc</code>&gt;</i></a>: <a href="#NWD1">U1</a>, <a href="#NWCex7-iniZ-1">D2</a>
<li><a href="#NWCex7-locY-1"><i>&lt;local declarations for <code>prettyC</code>&gt;</i></a>: <a href="#NWD1">U1</a>, <a href="#NWCex7-locY-1">D2</a>, <a href="#NWCex7-locY-2">D3</a>, <a href="#NWCex7-locY-3">D4</a>
<li><a href="#NWD2"><i>&lt;make <code>s</code> represent table <code>e</code>, but elide additive and multiplicative units&gt;</i></a>: <a href="#NWCex7-casL-1">U1</a>, <a href="#NWD2">D2</a>
<li><a href="#NWCex7-old1J-1"><i>&lt;old make <code>s</code> represent table <code>e</code>, but elide additive and multiplicative units&gt;</i></a>: <a href="#NWCex7-old1J-1">D1</a>
<li><a href="#NWCex7-resN-1"><i>&lt;restore <code>pc_override</code>&gt;</i></a>: <a href="#NWD3">U1</a>, <a href="#NWCex7-resN-1">D2</a>
</ul>
<ul>
<li><a name="NWI-Carm" href="#NWCex7-*-4">Carm</a>: <a href="#NWD6">U1</a>, <a href="#NWCex7-*-4">D2</a>
<li><a name="NWI-Cassoc" href="#NWCex7-*-8">Cassoc</a>: <a href="#NWCex7-*-8">D1</a>, <a href="#NWCex7-iniZ-1">U2</a>
<li><a name="NWI-Cbracket" href="#NWCex7-*-8">Cbracket</a>: <a href="#NWCex7-casL-1">U1</a>, <a href="#NWD2">U2</a>, <a href="#NWCex7-old1J-1">U3</a>, <a href="#NWCex7-casL-2">U4</a>, <a href="#NWCex7-casL-3">U5</a>, <a href="#NWCex7-casL-5">U6</a>, <a href="#NWCex7-dirZ-1">U7</a>, <a href="#NWD4">U8</a>, <a href="#NWCex7-casL-9">U9</a>, <a href="#NWCex7-casL-B">U10</a>, <a href="#NWCex7-casL-F">U11</a>, <a href="#NWCex7-casL-J">U12</a>, <a href="#NWCex7-casL-Q">U13</a>, <a href="#NWCex7-*-8">D14</a>
<li><a name="NWI-c_function_declaration" href="#NWD9">c_function_declaration</a>: <a href="#NWD9">D1</a>
<li><a name="NWI-Cnoreserve" href="#NWCex7-*-A">Cnoreserve</a>: <a href="#NWCex7-casL-E">U1</a>, <a href="#NWCex7-*-A">D2</a>
<li><a name="NWI-Cop" href="#NWCex7-*-9">Cop</a>: <a href="#NWCex7-casL-1">U1</a>, <a href="#NWCex7-*-9">D2</a>
<li><a name="NWI-Cprec" href="#NWCex7-*-8">Cprec</a>: <a href="#NWCex7-casL-1">U1</a>, <a href="#NWCex7-addR-1">U2</a>, <a href="#NWCex7-addR.2-1">U3</a>, <a href="#NWCex7-old1J-1">U4</a>, <a href="#NWCex7-casL-2">U5</a>, <a href="#NWCex7-casL-3">U6</a>, <a href="#NWCex7-casL-5">U7</a>, <a href="#NWCex7-dirZ-1">U8</a>, <a href="#NWD4">U9</a>, <a href="#NWCex7-casL-B">U10</a>, <a href="#NWCex7-casL-F">U11</a>, <a href="#NWCex7-casL-I">U12</a>, <a href="#NWCex7-casL-J">U13</a>, <a href="#NWCex7-casL-Q">U14</a>, <a href="#NWCex7-*-8">D15</a>, <a href="#NWCex7-iniZ-1">U16</a>
<li><a name="NWI-Ctest" href="#NWCex7-*-3">Ctest</a>: <a href="#NWD6">U1</a>, <a href="#NWCex7-*-3">D2</a>
<li><a name="NWI-Cuncomment" href="#NWD7">Cuncomment</a>: <a href="#NWCex7-casL-I">U1</a>, <a href="#NWD7">D2</a>, <a href="#NWCex7-casL-P">U3</a>, <a href="#NWCex7-casL-R">U4</a>
<li><a name="NWI-Generate_C" href="#NWD8">Generate_C</a>: <a href="#NWD8">D1</a>
<li><a name="NWI-hexstring" href="#NWCex7-*-B">hexstring</a>: <a href="#NWCex7-casL-1">U1</a>, <a href="#NWCex7-*-B">D2</a>
<li><a name="NWI-infer_C_type" href="#NWCex7-*-6">infer_C_type</a>: <a href="#NWCex7-casL-M">U1</a>, <a href="#NWCex7-*-6">D2</a>
<li><a name="NWI-pc_override" href="#NWCex7-*-2">pc_override</a>: <a href="#NWD5">U1</a>, <a href="#NWCex7-resN-1">U2</a>, <a href="#NWCex7-casL-7">U3</a>, <a href="#NWCex7-*-2">D4</a>
<li><a name="NWI-prettyC" href="#NWD1">prettyC</a>: <a href="#NWD1">D1</a>, <a href="#NWCex7-casL-1">U2</a>, <a href="#NWCex7-addR-1">U3</a>, <a href="#NWCex7-addR.2-1">U4</a>, <a href="#NWCex7-old1J-1">U5</a>, <a href="#NWCex7-casL-2">U6</a>, <a href="#NWCex7-casL-3">U7</a>, <a href="#NWCex7-casL-4">U8</a>, <a href="#NWCex7-casL-5">U9</a>, <a href="#NWD3">U10</a>, <a href="#NWCex7-dirZ-1">U11</a>, <a href="#NWD4">U12</a>, <a href="#NWCex7-casL-9">U13</a>, <a href="#NWCex7-casL-A">U14</a>, <a href="#NWCex7-casL-B">U15</a>, <a href="#NWCex7-casL-C">U16</a>, <a href="#NWCex7-casL-D">U17</a>, <a href="#NWCex7-casL-E">U18</a>, <a href="#NWCex7-casL-F">U19</a>, <a href="#NWCex7-*-3">U20</a>, <a href="#NWCex7-*-4">U21</a>, <a href="#NWCex7-casL-I">U22</a>, <a href="#NWCex7-casL-J">U23</a>, <a href="#NWCex7-casL-K">U24</a>, <a href="#NWCex7-casL-L">U25</a>, <a href="#NWCex7-casL-M">U26</a>, <a href="#NWCex7-casL-O">U27</a>, <a href="#NWCex7-casL-P">U28</a>, <a href="#NWCex7-casL-Q">U29</a>, <a href="#NWCex7-casL-R">U30</a>, <a href="#NWCex7-casL-S">U31</a>, <a href="#NWD8">U32</a>
<li><a name="NWI-signed_type" href="#NWCex7-*-7">signed_type</a>: <a href="#NWCex7-casL-R">U1</a>, <a href="#NWCex7-*-7">D2</a>
<li><a name="NWI-signed_width_comment" href="#NWCex7-*-7">signed_width_comment</a>: <a href="#NWCex7-*-7">D1</a>
<li><a name="NWI-unsigned_type" href="#NWCex7-*-7">unsigned_type</a>: <a href="#NWCex7-casL-R">U1</a>, <a href="#NWCex7-*-7">D2</a>
<li><a name="NWI-unsigned_width_comment" href="#NWCex7-*-7">unsigned_width_comment</a>: <a href="#NWCex7-*-7">D1</a>
</ul>
</body></html>

